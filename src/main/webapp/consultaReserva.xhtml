<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core">
    
    
	<ui:composition template="templatePrincipal.xhtml">
	
	    <ui:define name="content">
	        
		   	<h:form id="formConsulta">
		        <p:growl id="messages" showDetail="true" autoUpdate="true"/>
		        <p:panel header="Verificar Consultorias por CNPJ">
		            <h:panelGrid columns="3" cellpadding="5">
		                <p:outputLabel for="cnpjBusca" value="CNPJ:"/>
		                <p:inputMask id="cnpjBusca" value="#{consultarConsultoriaBean.cnpjBusca}" mask="99.999.999/9999-99" required="true"/>
		                
		                
		                <p:commandButton value="Buscar" 
		                                 actionListener="#{consultarConsultoriaBean.buscar()}"
		                                 update=":formConsulta:tabelaConsultorias"/> 
		            </h:panelGrid>
		        </p:panel>
		        
		        <p:dataTable id="tabelaConsultorias" var="c" value="#{consultarConsultoriaBean.getConsultoriasEncontradas()}"
		                     emptyMessage="Nenhuma consultoria encontrada para este CNPJ.">
		            
		            <p:column headerText="Cliente">
		            	<h:outputText value="#{c.getNomeEmpresa()}" />
		            </p:column>
		            
		            <p:column headerText="Descrição">
		            	<h:outputText value="#{c.getDescricao()}" />
		            </p:column>
		            
		            <p:column headerText="Data">
		                <h:outputText value="#{c.data}">
		                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="America/Sao_Paulo"/>
		                </h:outputText>
		            </p:column>
		            
		            
		            <p:column headerText="Ações">
		                
		                <p:commandButton icon="pi pi-pencil" title="Editar" 
		                                 actionListener="#{consultarConsultoriaBean.setConsultoriaSelecionada(c)}"
		                                 oncomplete="PF('dialogoEdicao').show()"
		                                 update=":formEdicao">
		                    <f:setPropertyActionListener value="#{c}" target="#{consultarConsultoriaBean.consultoriaSelecionada}" />
		                </p:commandButton>
		                
		                <p:commandButton icon="pi pi-trash" title="Excluir" actionListener="#{consultarConsultoriaBean.excluir(c)}" update="@form">		                 
		                </p:commandButton>
		            </p:column>
		            
		            
		            
		        </p:dataTable>

	    	</h:form>
	    	
	    	<p:dialog header="Editar Agendamento" widgetVar="dialogoEdicao" modal="true"
              showEffect="fade" hideEffect="fade" resizable="false">
		        <h:form id="formEdicao">
		            <h:panelGrid columns="2" cellpadding="7">
		                <p:outputLabel for="editCnpj" value="CNPJ:"/>
		                <p:inputMask id="editCnpj" value="#{consultarConsultoriaBean.consultoriaSelecionada.cnpj}" mask="99.999.999/9999-99" required="true"/>
		
		                <p:outputLabel for="editCliente" value="Nome do Cliente:"/>
		                <p:inputText id="editCliente" value="#{consultarConsultoriaBean.consultoriaSelecionada.nomeEmpresa}" required="true"/>
		
		                <p:outputLabel for="editDescricao" value="Descrição:"/>
		                <p:inputTextarea id="editDescricao" value="#{consultarConsultoriaBean.consultoriaSelecionada.descricao}" />
		
		                <p:outputLabel for="editData" value="Data e Hora:"/>
		                <p:calendar id="editData" value="#{consultarConsultoriaBean.consultoriaSelecionada.data}" pattern="dd/MM/yyyy HH:mm"
		                			timeZone="America/Sao_Paulo" showOn="button" required="true" mindate="#{consultarConsultoriaBean.dataMinima}"
		                			minHour="8" maxHour="17" mask="true"/>
		            </h:panelGrid>
		            
		            <p:commandButton value="Salvar Alterações" 
		                             actionListener="#{consultarConsultoriaBean.atualizar}"
		                             update=":formConsulta:messages :formConsulta:tabelaConsultorias" oncomplete="PF('dialogoEdicao').hide()"/>
		            <p:commandButton value="Cancelar" oncomplete="PF('dialogoEdicao').hide()" styleClass="ui-button-secondary" style="margin-left: 5px;"/>
		        </h:form>
		    </p:dialog>
	    	
	    	
	    	
	    </ui:define>
	
	</ui:composition>
</html>